# ğŸ•·ï¸ çˆ¬è™«é…ç½®æŒ‡å—

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜å¦‚ä½•æ·»åŠ æ–°çš„å­¦æ ¡å®˜ç½‘è¿›è¡Œå¯¼å¸ˆä¿¡æ¯çˆ¬å–ã€‚

## ğŸ“– åŸºç¡€æ¦‚å¿µ

ç³»ç»Ÿæ”¯æŒä¸¤ç§ä¸»è¦çš„ç½‘é¡µç»“æ„:

### 1. ä¸¤å±‚ç»“æ„ (Two-level)

æœ€å¸¸è§çš„ç»“æ„,é€‚ç”¨äºå¤§å¤šæ•°å­¦æ ¡å®˜ç½‘ã€‚

- **åˆ—è¡¨é¡µ**: å±•ç¤ºå¯¼å¸ˆå§“åå’Œé“¾æ¥
- **è¯¦æƒ…é¡µ**: ç‚¹å‡»å§“ååè¿›å…¥,åŒ…å«å®Œæ•´ä¿¡æ¯(é‚®ç®±ã€ç ”ç©¶æ–¹å‘ç­‰)

**ç¤ºä¾‹**: åŒ—äº¬ç†å·¥å¤§å­¦è‡ªåŠ¨åŒ–å­¦é™¢
- åˆ—è¡¨é¡µ: `https://ac.bit.edu.cn/szdw/dsmd/bssds/index.htm`
- è¯¦æƒ…é¡µ: `https://ac.bit.edu.cn/szdw/.../professor_name.htm`

### 2. å•é¡µç»“æ„ (Single-page)

æ‰€æœ‰ä¿¡æ¯åœ¨ä¸€ä¸ªé¡µé¢å±•ç¤º,é€šå¸¸æ˜¯è¡¨æ ¼å½¢å¼ã€‚(å¾…å¼€å‘)

## ğŸ› ï¸ é…ç½®æ­¥éª¤

### ç¬¬ä¸€æ­¥: åˆ†æç½‘é¡µç»“æ„

1. **è®¿é—®å­¦æ ¡å®˜ç½‘çš„å¯¼å¸ˆåˆ—è¡¨é¡µ**

ä¾‹å¦‚: `https://www.example.edu.cn/faculty/professors.html`

2. **æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·** (F12)

3. **æŸ¥çœ‹ HTML ç»“æ„**

å³é”®ç‚¹å‡»å¯¼å¸ˆå§“å â†’ æ£€æŸ¥å…ƒç´ ,è§‚å¯Ÿ HTML ä»£ç :

```html
<ul class="professor-list">
  <li>
    <a href="detail/zhangsan.html">å¼ ä¸‰</a>
  </li>
  <li>
    <a href="detail/lisi.html">æå››</a>
  </li>
</ul>
```

è®°å½•ä»¥ä¸‹ä¿¡æ¯:
- åˆ—è¡¨å®¹å™¨: `ul.professor-list > li`
- é“¾æ¥é€‰æ‹©å™¨: `a`
- å§“åä½ç½®: åœ¨ `a` æ ‡ç­¾çš„æ–‡æœ¬ä¸­

4. **æŸ¥çœ‹è¯¦æƒ…é¡µç»“æ„**

ç‚¹å‡»è¿›å…¥ä¸€ä¸ªå¯¼å¸ˆçš„è¯¦æƒ…é¡µ,åŒæ ·ç”¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹:

```html
<div class="profile">
  <h2>å¼ ä¸‰</h2>
  <p>èŒç§°: æ•™æˆ</p>
  <p>é‚®ç®±: <a href="mailto:zhangsan@example.edu.cn">zhangsan@example.edu.cn</a></p>
  <div class="research">
    <h3>ç ”ç©¶æ–¹å‘</h3>
    <p>æœºå™¨å­¦ä¹ , è®¡ç®—æœºè§†è§‰, æ·±åº¦å­¦ä¹ </p>
  </div>
</div>
```

è®°å½•å…³é”®å­—æ®µçš„ä½ç½®ã€‚

### ç¬¬äºŒæ­¥: ç¼–å†™é…ç½®

ç¼–è¾‘ `crawler/config.yaml`,æ·»åŠ æ–°å­¦æ ¡:

```yaml
universities:
  - name: "æ¸…åå¤§å­¦è®¡ç®—æœºç³»"  # å­¦æ ¡åç§°
    url: "https://www.cs.tsinghua.edu.cn/faculty/list.html"  # åˆ—è¡¨é¡µ URL
    scraper_type: "two_level"  # çˆ¬è™«ç±»å‹
    enabled: true  # æ˜¯å¦å¯ç”¨
    update_frequency: "weekly"  # æ›´æ–°é¢‘ç‡

    # åˆ—è¡¨é¡µé…ç½®
    list_page:
      container_selector: "ul.professor-list > li"  # å¯¼å¸ˆåˆ—è¡¨çš„å®¹å™¨
      link_selector: "a"  # è¯¦æƒ…é¡µé“¾æ¥
      name_selector: "a"  # å¯¼å¸ˆå§“åä½ç½®

    # è¯¦æƒ…é¡µé…ç½®
    detail_page:
      # é‚®ç®±æå–è§„åˆ™ (æŒ‰ä¼˜å…ˆçº§å°è¯•)
      email:
        - selector: "a[href^='mailto:']"  # æ–¹æ³•1: é€šè¿‡ mailto é“¾æ¥
          extract: "href"
          pattern: "mailto:(.*)"
        - pattern: "[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}"  # æ–¹æ³•2: æ­£åˆ™åŒ¹é…

      # ç”µè¯æå–è§„åˆ™
      phone:
        - pattern: "\\d{3,4}-\\d{7,8}|\\d{11}"  # å›ºå®šç”µè¯æˆ–æ‰‹æœºå·

      # èŒç§°æå–è§„åˆ™
      title:
        - pattern: "(æ•™æˆ|å‰¯æ•™æˆ|ç ”ç©¶å‘˜|è®²å¸ˆ)"  # æ–¹æ³•1: æ­£åˆ™åŒ¹é…
        - selector: "span.title, .èŒç§°"  # æ–¹æ³•2: CSSé€‰æ‹©å™¨

      # ç ”ç©¶æ–¹å‘æå–è§„åˆ™
      research_areas:
        - keywords: ["ç ”ç©¶æ–¹å‘", "ç ”ç©¶é¢†åŸŸ", "Research Interests"]  # é€šè¿‡å…³é”®è¯å®šä½
          extract_method: "next_sibling_text"  # æå–ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹çš„æ–‡æœ¬
        - selector: ".research, .ç ”ç©¶æ–¹å‘"  # æˆ–ç›´æ¥é€šè¿‡CSSé€‰æ‹©å™¨

      # åŠå…¬å®¤ä½ç½®
      office:
        - keywords: ["åŠå…¬å®¤", "Office"]
          extract_method: "next_sibling_text"
```

### ç¬¬ä¸‰æ­¥: æµ‹è¯•çˆ¬è™«

```bash
cd crawler
python main.py --url "https://www.cs.tsinghua.edu.cn/faculty/list.html" --dry-run
```

æŸ¥çœ‹è¾“å‡º,ç¡®è®¤:
- âœ… èƒ½æ‰¾åˆ°å¯¼å¸ˆåˆ—è¡¨
- âœ… èƒ½è¿›å…¥è¯¦æƒ…é¡µ
- âœ… èƒ½æå–é‚®ç®±ã€èŒç§°ç­‰ä¿¡æ¯

### ç¬¬å››æ­¥: æ­£å¼çˆ¬å–

å¦‚æœæµ‹è¯•æˆåŠŸ:

```bash
python main.py --url "https://www.cs.tsinghua.edu.cn/faculty/list.html"
```

æ•°æ®ä¼šè‡ªåŠ¨åŒæ­¥åˆ°æ•°æ®åº“ã€‚

## ğŸ¯ é«˜çº§é…ç½®

### å¤„ç†ç‰¹æ®Šæƒ…å†µ

#### 1. å§“ååœ¨ä¸åŒä½ç½®

å¦‚æœå§“åä¸åœ¨é“¾æ¥æ–‡æœ¬ä¸­,è€Œæ˜¯åœ¨å…¶ä»–åœ°æ–¹:

```yaml
list_page:
  container_selector: "div.professor-card"
  link_selector: "a.detail-link"
  name_selector: "h3.name"  # å•ç‹¬æŒ‡å®šå§“åä½ç½®
```

#### 2. éœ€è¦å¤„ç†ç›¸å¯¹è·¯å¾„

çˆ¬è™«ä¼šè‡ªåŠ¨å°†ç›¸å¯¹è·¯å¾„è½¬ä¸ºç»å¯¹è·¯å¾„,æ— éœ€é¢å¤–é…ç½®ã€‚

ä¾‹å¦‚é“¾æ¥æ˜¯ `detail/zhangsan.html`,ä¼šè‡ªåŠ¨è½¬ä¸º:
`https://www.example.edu.cn/detail/zhangsan.html`

#### 3. ç ”ç©¶æ–¹å‘åœ¨ç‰¹æ®Šæ ¼å¼ä¸­

å¦‚æœç ”ç©¶æ–¹å‘åœ¨åˆ—è¡¨ä¸­:

```html
<h3>ç ”ç©¶æ–¹å‘:</h3>
<ul>
  <li>æœºå™¨å­¦ä¹ </li>
  <li>è®¡ç®—æœºè§†è§‰</li>
</ul>
```

é…ç½®:

```yaml
research_areas:
  - keywords: ["ç ”ç©¶æ–¹å‘"]
    extract_method: "parent_text"  # æå–çˆ¶èŠ‚ç‚¹çš„æ‰€æœ‰æ–‡æœ¬
```

#### 4. åŠ¨æ€åŠ è½½å†…å®¹ (JavaScript æ¸²æŸ“)

å¯¹äºä½¿ç”¨ JavaScript åŠ¨æ€åŠ è½½çš„é¡µé¢,éœ€è¦å®‰è£… Selenium:

```bash
pip install selenium webdriver-manager
```

ç„¶åç¼–å†™è‡ªå®šä¹‰çˆ¬è™«(å¾…å¼€å‘åŠŸèƒ½)ã€‚

### è°ƒæ•´çˆ¬å–é€Ÿåº¦

ç¼–è¾‘ `config.yaml` çš„å…¨å±€è®¾ç½®:

```yaml
settings:
  request_delay: 1.5  # æ¯æ¬¡è¯·æ±‚é—´éš”(ç§’),é¿å…é¢‘ç¹è®¿é—®
  timeout: 30  # è¯·æ±‚è¶…æ—¶æ—¶é—´
  max_retries: 3  # å¤±è´¥é‡è¯•æ¬¡æ•°
```

## ğŸ“ é…ç½®å­—æ®µå‚è€ƒ

### list_page (åˆ—è¡¨é¡µé…ç½®)

| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `container_selector` | å¯¼å¸ˆåˆ—è¡¨å®¹å™¨çš„ CSS é€‰æ‹©å™¨ | `"ul > li"` |
| `link_selector` | è¯¦æƒ…é¡µé“¾æ¥çš„é€‰æ‹©å™¨ | `"a"` |
| `name_selector` | å¯¼å¸ˆå§“åçš„é€‰æ‹©å™¨ | `"a"` æˆ– `"h3.name"` |

### detail_page (è¯¦æƒ…é¡µé…ç½®)

æ¯ä¸ªå­—æ®µæ”¯æŒå¤šä¸ªæå–è§„åˆ™,æŒ‰ä¼˜å…ˆçº§å°è¯•ã€‚

#### æå–è§„åˆ™ç±»å‹

**1. CSS é€‰æ‹©å™¨**

```yaml
email:
  - selector: "a[href^='mailto:']"
    extract: "href"  # æå–å±æ€§å€¼,é»˜è®¤æå–æ–‡æœ¬
    pattern: "mailto:(.*)"  # å¯é€‰: æ­£åˆ™æå–
```

**2. æ­£åˆ™è¡¨è¾¾å¼**

```yaml
phone:
  - pattern: "\\d{3}-\\d{8}"  # åŒ¹é… 010-12345678 æ ¼å¼
```

**3. å…³é”®è¯å®šä½**

```yaml
research_areas:
  - keywords: ["ç ”ç©¶æ–¹å‘", "Research Interests"]
    extract_method: "next_sibling_text"  # æˆ– "parent_text"
```

#### æå–æ–¹æ³• (extract_method)

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `next_sibling_text` | æå–ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹çš„æ–‡æœ¬ |
| `parent_text` | æå–çˆ¶èŠ‚ç‚¹çš„æ‰€æœ‰æ–‡æœ¬ |

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹åŸå§‹ HTML

çˆ¬è™«ä¼šä¿å­˜éƒ¨åˆ†åŸå§‹ HTML åˆ°æ•°æ®åº“çš„ `raw_html` å­—æ®µ,å¯ç”¨äºè°ƒè¯•:

```sql
SELECT name, raw_html FROM professors WHERE name = 'å¼ ä¸‰';
```

### 2. å¢åŠ æ—¥å¿—è¾“å‡º

ç¼–è¾‘ `crawler/scrapers/base_scraper.py`,å–æ¶ˆæ³¨é‡Šè°ƒè¯•è¯­å¥ã€‚

### 3. å•ç‹¬æµ‹è¯•æŸä¸ªå­¦æ ¡

```bash
python main.py --url "https://specific-university.edu.cn" --dry-run
```

## â“ å¸¸è§é—®é¢˜

**Q: çˆ¬è™«æ‰¾ä¸åˆ°å¯¼å¸ˆåˆ—è¡¨**

A:
1. æ£€æŸ¥ `container_selector` æ˜¯å¦æ­£ç¡®
2. ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·éªŒè¯é€‰æ‹©å™¨
3. ç½‘é¡µå¯èƒ½ä½¿ç”¨ JavaScript åŠ¨æ€åŠ è½½,éœ€è¦ç‰¹æ®Šå¤„ç†

**Q: èƒ½æ‰¾åˆ°å¯¼å¸ˆä½†æå–ä¸åˆ°é‚®ç®±**

A:
1. æ£€æŸ¥è¯¦æƒ…é¡µæ˜¯å¦çœŸçš„åŒ…å«é‚®ç®±
2. å°è¯•å¤šç§æå–è§„åˆ™(CSSé€‰æ‹©å™¨ + æ­£åˆ™è¡¨è¾¾å¼)
3. æŸ¥çœ‹ `raw_html` ç¡®è®¤æ•°æ®å­˜åœ¨

**Q: éƒ¨åˆ†å¯¼å¸ˆçˆ¬å–å¤±è´¥**

A:
1. å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜,é‡æ–°è¿è¡Œçˆ¬è™«
2. éƒ¨åˆ†å¯¼å¸ˆé¡µé¢ç»“æ„ä¸åŒ,éœ€è¦é¢å¤–å¤„ç†
3. æŸ¥çœ‹çˆ¬è™«æ—¥å¿—ç¡®è®¤é”™è¯¯åŸå› 

**Q: çˆ¬å–é€Ÿåº¦å¤ªæ…¢**

A:
1. å‡å° `request_delay`(ä½†ä¸è¦å¤ªå°,é¿å…è¢«å°IP)
2. ä½¿ç”¨ `max_workers` å¹¶å‘çˆ¬å–(å¾…å¼€å‘)

**Q: è¢«å­¦æ ¡ç½‘ç«™å±è”½**

A:
1. å¢åŠ  `request_delay`,é™ä½è®¿é—®é¢‘ç‡
2. ä¿®æ”¹ `user_agent`,æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨
3. ä½¿ç”¨ä»£ç†IP(é«˜çº§åŠŸèƒ½)

## ğŸ“ ç¤ºä¾‹é…ç½®

### ç¤ºä¾‹ 1: æ¸…åå¤§å­¦è®¡ç®—æœºç³»

```yaml
- name: "æ¸…åå¤§å­¦è®¡ç®—æœºç³»"
  url: "https://www.cs.tsinghua.edu.cn/info/1083/3973.htm"
  scraper_type: "two_level"
  enabled: true

  list_page:
    container_selector: "ul.list > li"
    link_selector: "a"
    name_selector: "a"

  detail_page:
    email:
      - pattern: "[a-zA-Z0-9._%+-]+@tsinghua\\.edu\\.cn"
    title:
      - pattern: "(æ•™æˆ|å‰¯æ•™æˆ)"
    research_areas:
      - keywords: ["ç ”ç©¶æ–¹å‘"]
        extract_method: "next_sibling_text"
```

### ç¤ºä¾‹ 2: åŒ—äº¬å¤§å­¦ä¿¡ç§‘å­¦é™¢

```yaml
- name: "åŒ—äº¬å¤§å­¦ä¿¡æ¯ç§‘å­¦æŠ€æœ¯å­¦é™¢"
  url: "https://eecs.pku.edu.cn/szdw/zzjs/index.htm"
  scraper_type: "two_level"
  enabled: true

  list_page:
    container_selector: "div.teacher-list > div.item"
    link_selector: "a.name"
    name_selector: "a.name"

  detail_page:
    email:
      - selector: "a[href^='mailto:']"
        extract: "href"
        pattern: "mailto:(.*)"
    title:
      - selector: "span.title"
    research_areas:
      - selector: "div.research-area"
```

---

å¦‚æœ‰å…¶ä»–é—®é¢˜,æ¬¢è¿æ Issue æˆ–æŸ¥çœ‹ [å®Œæ•´æ–‡æ¡£](../README.md)ã€‚
